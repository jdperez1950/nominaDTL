"use strict";(self.webpackChunkflexy=self.webpackChunkflexy||[]).push([[843],{843:(ie,_,c)=>{c.r(_),c.d(_,{AuthenticationRoutes:()=>se});var d=c(2168),f=c(177),n=c(9417),b=c(8032),m=c.n(b),p=c(2102),R=c(9042),I=c(8834),P=c(2765),e=c(4438),S=c(4019);function L(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," El nombre de usuario es requerido y debe tener al menos 4 caracteres. "),e.k0s())}function F(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," La contrase\xf1a es requerida. "),e.k0s())}function D(i,l){if(1&i&&(e.j41(0,"p",8),e.EFF(1),e.k0s()),2&i){const o=e.XpG();e.R7$(),e.JRh(o.errorMessage)}}let U=(()=>{class i{constructor(o,s){this.authService=o,this.router=s,this.errorMessage="",this.form=new n.gE({uname:new n.MJ("",[n.k0.required,n.k0.minLength(4)]),password:new n.MJ("",[n.k0.required])})}get f(){return this.form.controls}submit(){if(this.form.invalid)return void m().fire({title:"Formulario inv\xe1lido",text:"Por favor, completa todos los campos correctamente.",icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"var(--colorPrimario)"});const{uname:o,password:s}=this.form.value;o&&s&&this.authService.login(o,s).subscribe({next:t=>{localStorage.setItem("token",t.token),localStorage.setItem("permisos",t.permisos),m().fire({title:"\xa1Inicio de sesi\xf3n exitoso!",text:"Redirigiendo al inicio...",icon:"success",confirmButtonText:"OK",confirmButtonColor:"var(--colorPrimario)"}).then(()=>{this.router.navigate(["/inicio"])})},error:t=>{console.error("Error en el login:",t),m().fire({title:"Error en el login",text:"Usuario o contrase\xf1a incorrectos.",icon:"error",confirmButtonText:"Intentar de nuevo",confirmButtonColor:"var(--colorPrimario)"})}})}static{this.\u0275fac=function(s){return new(s||i)(e.rXU(S.u),e.rXU(d.Ix))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-login-tradicional"]],standalone:!0,features:[e.aNF],decls:16,vars:5,consts:[[1,"m-t-30",3,"ngSubmit","formGroup"],[1,"mat-subtitle-2","f-s-14","f-w-600","m-b-12","d-block"],["appearance","outline","color","primary",1,"w-100"],["matInput","","formControlName","uname","placeholder","Ingresa tu nombre de usuario"],[4,"ngIf"],["matInput","","type","password","formControlName","password","placeholder","Ingresa tu contrase\xf1a"],["mat-flat-button","","color","primary","type","submit",1,"w-100",3,"disabled"],["class","error-message text-center",4,"ngIf"],[1,"error-message","text-center"]],template:function(s,t){1&s&&(e.j41(0,"form",0),e.bIt("ngSubmit",function(){return t.submit()}),e.j41(1,"mat-label",1),e.EFF(2,"Nombre de usuario"),e.k0s(),e.j41(3,"mat-form-field",2),e.nrm(4,"input",3),e.DNE(5,L,2,0,"mat-error",4),e.k0s(),e.nrm(6,"br")(7,"br"),e.j41(8,"mat-label",1),e.EFF(9,"Contrase\xf1a"),e.k0s(),e.j41(10,"mat-form-field",2),e.nrm(11,"input",5),e.DNE(12,F,2,0,"mat-error",4),e.k0s(),e.j41(13,"button",6),e.EFF(14," Iniciar sesi\xf3n "),e.k0s(),e.DNE(15,D,2,1,"p",7),e.k0s()),2&s&&(e.Y8G("formGroup",t.form),e.R7$(5),e.Y8G("ngIf",t.f.uname.invalid&&t.f.uname),e.R7$(7),e.Y8G("ngIf",t.f.password.invalid&&t.f.password),e.R7$(),e.Y8G("disabled",t.form.invalid),e.R7$(2),e.Y8G("ngIf",t.errorMessage))},dependencies:[n.X1,n.qT,n.me,n.BC,n.cb,n.j4,n.JD,p.RG,p.rl,p.nJ,p.TL,R.fS,R.fg,I.Hl,I.$z,P.g7,f.MD,f.bT,d.iI]})}}return i})();var O=c(467),E=c(4412),N=c(2771),j=c(1413);class C extends j.B{constructor(){super(...arguments),this._value=null,this._hasValue=!1,this._isComplete=!1}_checkFinalizedStatuses(l){const{hasError:o,_hasValue:s,_value:t,thrownError:r,isStopped:a,_isComplete:u}=this;o?l.error(r):(a||u)&&(s&&l.next(t),l.complete())}next(l){this.isStopped||(this._value=l,this._hasValue=!0)}complete(){const{_hasValue:l,_value:o,_isComplete:s}=this;s||(this._isComplete=!0,l&&super.next(o),super.complete())}}var A=c(4402),k=c(5245),M=c(5964),G=c(6697);class V{constructor(){}loadScript(l,o,s,t=null){if(typeof document<"u"&&!document.getElementById(l)){let r=document.createElement("script");r.async=!0,r.src=o,r.onload=s,t||(t=document.head),t.appendChild(r)}}}class z{}const B={oneTapEnabled:!0};let h=(()=>{class i extends V{static{this.PROVIDER_ID="GOOGLE"}constructor(o,s){super(),this.clientId=o,this.initOptions=s,this.changeUser=new e.bkB,this._socialUser=new E.t(null),this._accessToken=new E.t(null),this._receivedAccessToken=new e.bkB,this.initOptions={...B,...this.initOptions},this._socialUser.pipe((0,k.i)(1)).subscribe(this.changeUser),this._accessToken.pipe((0,k.i)(1)).subscribe(this._receivedAccessToken)}initialize(o,s){return new Promise((t,r)=>{try{this.loadScript(i.PROVIDER_ID,this.getGoogleLoginScriptSrc(s),()=>{if(google.accounts.id.initialize({client_id:this.clientId,auto_select:o,callback:({credential:a})=>{const u=this.createSocialUser(a);this._socialUser.next(u)},prompt_parent_id:this.initOptions?.prompt_parent_id,itp_support:this.initOptions.oneTapEnabled,use_fedcm_for_prompt:this.initOptions.oneTapEnabled}),this.initOptions.oneTapEnabled&&this._socialUser.pipe((0,M.p)(a=>null===a)).subscribe(()=>google.accounts.id.prompt(console.debug)),this.initOptions.scopes){const a=this.initOptions.scopes instanceof Array?this.initOptions.scopes.filter(u=>u).join(" "):this.initOptions.scopes;this._tokenClient=google.accounts.oauth2.initTokenClient({client_id:this.clientId,scope:a,prompt:this.initOptions.prompt,callback:u=>{u.error?this._accessToken.error({code:u.error,description:u.error_description,uri:u.error_uri}):this._accessToken.next(u.access_token)}})}t()})}catch(a){r(a)}})}getLoginStatus(){return new Promise((o,s)=>{this._socialUser.value?o(this._socialUser.value):s(`No user is currently logged in with ${i.PROVIDER_ID}`)})}refreshToken(){return new Promise((o,s)=>{google.accounts.id.revoke(this._socialUser.value.id,t=>{t.error?s(t.error):o(this._socialUser.value)})})}getAccessToken(){return new Promise((o,s)=>{this._tokenClient?(this._tokenClient.requestAccessToken({hint:this._socialUser.value?.email}),this._receivedAccessToken.pipe((0,G.s)(1)).subscribe(o)):s(this._socialUser.value?"No token client was instantiated, you should specify some scopes.":"You should be logged-in first.")})}revokeAccessToken(){return new Promise((o,s)=>{this._tokenClient?this._accessToken.value?google.accounts.oauth2.revoke(this._accessToken.value,()=>{this._accessToken.next(null),o()}):s("No access token to revoke"):s("No token client was instantiated, you should specify some scopes.")})}signIn(){return Promise.reject('You should not call this method directly for Google, use "<asl-google-signin-button>" wrapper or generate the button yourself with "google.accounts.id.renderButton()" (https://developers.google.com/identity/gsi/web/guides/display-button#javascript)')}signOut(){var o=this;return(0,O.A)(function*(){google.accounts.id.disableAutoSelect(),o._socialUser.next(null)})()}createSocialUser(o){const s=new z;s.idToken=o;const t=this.decodeJwt(o);return s.id=t.sub,s.name=t.name,s.email=t.email,s.photoUrl=t.picture,s.firstName=t.given_name,s.lastName=t.family_name,s}decodeJwt(o){const t=o.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(window.atob(t).split("").map(function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(r)}getGoogleLoginScriptSrc(o){return o?`https://accounts.google.com/gsi/client?hl=${o}`:"https://accounts.google.com/gsi/client"}}return i})(),$=(()=>{class i{static{this.ERR_LOGIN_PROVIDER_NOT_FOUND="Login provider not found"}static{this.ERR_NOT_LOGGED_IN="Not logged in"}static{this.ERR_NOT_INITIALIZED="Login providers not ready yet. Are there errors on your console?"}static{this.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN="Chosen login provider is not supported for refreshing a token"}static{this.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN="Chosen login provider is not supported for getting an access token"}get authState(){return this._authState.asObservable()}get initState(){return this._initState.asObservable()}constructor(o,s,t){this._ngZone=s,this._injector=t,this.providers=new Map,this.autoLogin=!1,this.lang="",this._user=null,this._authState=new N.m(1),this.initialized=!1,this._initState=new C,o instanceof Promise?o.then(r=>{this.initialize(r)}):this.initialize(o)}initialize(o){this.autoLogin=void 0!==o.autoLogin&&o.autoLogin,this.lang=void 0!==o.lang?o.lang:"";const{onError:s=console.error}=o;o.providers.forEach(t=>{this.providers.set(t.id,"prototype"in t.provider?this._injector.get(t.provider):t.provider)}),Promise.all(Array.from(this.providers.values()).map(t=>t.initialize(this.autoLogin,this.lang))).then(()=>{if(this.autoLogin){const t=[];let r=!1;this.providers.forEach((a,u)=>{const v=a.getLoginStatus();t.push(v),v.then(y=>{this.setUser(y,u),r=!0}).catch(console.debug)}),Promise.all(t).catch(()=>{r||(this._user=null,this._authState.next(null))})}this.providers.forEach((t,r)=>{(0,A.A)(t.changeUser)&&t.changeUser.subscribe(a=>{this._ngZone.run(()=>{this.setUser(a,r)})})})}).catch(t=>{s(t)}).finally(()=>{this.initialized=!0,this._initState.next(this.initialized),this._initState.complete()})}getAccessToken(o){var s=this;return(0,O.A)(function*(){const t=s.providers.get(o);if(!s.initialized)throw i.ERR_NOT_INITIALIZED;if(!t)throw i.ERR_LOGIN_PROVIDER_NOT_FOUND;if(!(t instanceof h))throw i.ERR_NOT_SUPPORTED_FOR_ACCESS_TOKEN;return yield t.getAccessToken()})()}refreshAuthToken(o){return new Promise((s,t)=>{if(this.initialized){const r=this.providers.get(o);r?"function"!=typeof r.refreshToken?t(i.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN):r.refreshToken().then(a=>{this.setUser(a,o),s()}).catch(a=>{t(a)}):t(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else t(i.ERR_NOT_INITIALIZED)})}refreshAccessToken(o){return new Promise((s,t)=>{if(this.initialized)if(o!==h.PROVIDER_ID)t(i.ERR_NOT_SUPPORTED_FOR_REFRESH_TOKEN);else{const r=this.providers.get(o);r instanceof h?r.revokeAccessToken().then(s).catch(t):t(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else t(i.ERR_NOT_INITIALIZED)})}signIn(o,s){return new Promise((t,r)=>{if(this.initialized){let a=this.providers.get(o);a?a.signIn(s).then(u=>{this.setUser(u,o),t(u)}).catch(u=>{r(u)}):r(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else r(i.ERR_NOT_INITIALIZED)})}signOut(o=!1){return new Promise((s,t)=>{if(this.initialized)if(this._user){let a=this.providers.get(this._user.provider);a?a.signOut(o).then(()=>{s(),this.setUser(null)}).catch(u=>{t(u)}):t(i.ERR_LOGIN_PROVIDER_NOT_FOUND)}else t(i.ERR_NOT_LOGGED_IN);else t(i.ERR_NOT_INITIALIZED)})}setUser(o,s){o&&s&&(o.provider=s),this._user=o,this._authState.next(o)}static{this.\u0275fac=function(s){return new(s||i)(e.KVO("SocialAuthServiceConfig"),e.KVO(e.SKi),e.KVO(e.zZn))}}static{this.\u0275prov=e.jDH({token:i,factory:i.\u0275fac,providedIn:"root"})}}return i})();var g=c(5596),T=c(5312);const K=()=>["/dashboard"];let Y=(()=>{class i{constructor(){this.logoExtensions=["png","jpg","jpeg","webp","svg"],this.logoSrc="./assets/images/logos/logoProyecto.jpg"}ngOnInit(){}static{this.\u0275fac=function(s){return new(s||i)}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-side-login"]],standalone:!0,features:[e.Jv_([$,{provide:"SocialAuthServiceConfig",useValue:{autoLogin:!1,providers:[{id:h.PROVIDER_ID,provider:new h(T.c.googleClientId)}]}}]),e.aNF],decls:17,vars:3,consts:[[1,"blank-layout-container","justify-content-center","align-items-center","bg-light"],[1,"position-relative","row","w-100","h-100","bg-gredient","justify-content-center"],[1,"col-lg-4","d-flex","align-items-center"],[1,"cardWithShadow","boxed-auth"],[1,"p-32"],[1,"text-center"],[3,"routerLink"],["alt","logo",1,"align-middle","m-2",2,"width","120px","height","120px","object-fit","contain",3,"src"],[1,"row","m-t-24","custom-row"],[1,"or-border","m-t-30"]],template:function(s,t){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-content",4)(5,"div",5)(6,"a",6),e.nrm(7,"img",7),e.k0s()(),e.j41(8,"div",8),e.nrm(9,"br")(10,"br")(11,"br"),e.k0s(),e.j41(12,"div",9),e.EFF(13,"Inicia sesi\xf3n con"),e.k0s(),e.nrm(14,"app-login-tradicional")(15,"br")(16,"div"),e.k0s()()()()()),2&s&&(e.R7$(6),e.Y8G("routerLink",e.lJ4(2,K)),e.R7$(),e.Y8G("src",t.logoSrc,e.B4B))},dependencies:[f.MD,d.iI,d.Wk,g.Hu,g.RN,g.m2,U],encapsulation:2})}}return i})();var w=c(1626),J=c(821);const q=()=>["/authentication/login"];function H(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," El nombre es obligatorio. "),e.k0s())}function Z(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," El nombre de usuario es obligatorio. "),e.k0s())}function X(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," El correo es obligatorio. "),e.k0s())}function W(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," El correo no es v\xe1lido. "),e.k0s())}function Q(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," La contrase\xf1a es obligatoria. "),e.k0s())}function ee(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," La contrase\xf1a debe tener al menos 8 caracteres. "),e.k0s())}function te(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," Debes confirmar tu contrase\xf1a. "),e.k0s())}function oe(i,l){1&i&&(e.j41(0,"mat-error"),e.EFF(1," Las contrase\xf1as no coinciden. "),e.k0s())}const se=[{path:"",children:[{path:"login",component:Y},{path:"register",component:(()=>{class i{constructor(o,s){this.router=o,this.http=s,this.form=new n.gE({name:new n.MJ("",[n.k0.required]),username:new n.MJ("",[n.k0.required]),correo:new n.MJ("",[n.k0.required,n.k0.email]),password:new n.MJ("",[n.k0.required,n.k0.minLength(8)]),repeatedPassword:new n.MJ("",[n.k0.required,n.k0.minLength(8)])},{validators:this.passwordMatchValidator()})}goToLogin(){this.router.navigate(["/authentication/login"])}passwordMatchValidator(){return o=>{const s=o.get("password")?.value,t=o.get("repeatedPassword")?.value;return s===t?null:{passwordsMismatch:!0}}}get f(){return this.form.controls}submit(){if(this.form.valid){const o={name:this.form.get("name")?.value,username:this.form.get("username")?.value,correo:this.form.get("correo")?.value,password:this.form.get("password")?.value,repeatedPassword:this.form.get("repeatedPassword")?.value};console.log("Datos enviados al backend:",o),this.http.post(T.c.baseUrlRegistro,o).subscribe(s=>{console.log("Usuario registrado con \xe9xito:",s),this.router.navigate(["/authentication/login"]),m().fire({title:"\xa1Usuario registrado!",text:"El usuario se ha registrado correctamente.",icon:"success",confirmButtonText:"OK",confirmButtonColor:"var(--colorPrimario)"}).then(()=>{window.location.reload()})},s=>{console.error("Error al registrar usuario:",s),m().fire({title:"Error",text:s.error.backedMessage||"Error al registrar. Por favor, intenta nuevamente.",icon:"error",confirmButtonText:"Cerrar",confirmButtonColor:"var(--colorPrimario)"})})}else m().fire({title:"Formulario inv\xe1lido",text:"Por favor, revisa los campos del formulario.",icon:"warning",confirmButtonText:"Entendido",confirmButtonColor:"var(--colorPrimario)"})}static{this.\u0275fac=function(s){return new(s||i)(e.rXU(d.Ix),e.rXU(w.Qq))}}static{this.\u0275cmp=e.VBU({type:i,selectors:[["app-side-register"]],standalone:!0,features:[e.aNF],decls:40,vars:12,consts:[[1,"blank-layout-container","justify-content-center","align-items-center","bg-light"],[1,"position-relative","row","w-100","h-100","bg-gredient","justify-content-center"],[1,"col-lg-4","d-flex","align-items-center"],[1,"cardWithShadow","boxed-auth"],[1,"p-32"],[3,"ngSubmit","formGroup"],["appearance","outline",1,"w-100"],["matInput","","formControlName","name","placeholder","Ingresa tu nombre"],[4,"ngIf"],["matInput","","formControlName","username","placeholder","Ingresa tu usuario"],["matInput","","type","email","formControlName","correo","placeholder","Ingresa tu correo"],["matInput","","type","password","formControlName","password","placeholder","Ingresa tu contrase\xf1a"],["matInput","","type","password","formControlName","repeatedPassword","placeholder","Repite tu contrase\xf1a"],["mat-flat-button","","color","primary","type","submit",1,"w-100",3,"disabled"],[1,"d-block","f-w-500","text-center","m-t-24"],[1,"text-decoration-none","text-primary","f-w-500","f-s-14",3,"routerLink"]],template:function(s,t){1&s&&(e.j41(0,"div",0)(1,"div",1)(2,"div",2)(3,"mat-card",3)(4,"mat-card-content",4)(5,"form",5),e.bIt("ngSubmit",function(){return t.submit()}),e.j41(6,"mat-form-field",6)(7,"mat-label"),e.EFF(8,"Nombre"),e.k0s(),e.nrm(9,"input",7),e.DNE(10,H,2,0,"mat-error",8),e.k0s(),e.j41(11,"mat-form-field",6)(12,"mat-label"),e.EFF(13,"Nombre de usuario"),e.k0s(),e.nrm(14,"input",9),e.DNE(15,Z,2,0,"mat-error",8),e.k0s(),e.j41(16,"mat-form-field",6)(17,"mat-label"),e.EFF(18,"Correo electr\xf3nico"),e.k0s(),e.nrm(19,"input",10),e.DNE(20,X,2,0,"mat-error",8)(21,W,2,0,"mat-error",8),e.k0s(),e.j41(22,"mat-form-field",6)(23,"mat-label"),e.EFF(24,"Contrase\xf1a"),e.k0s(),e.nrm(25,"input",11),e.DNE(26,Q,2,0,"mat-error",8)(27,ee,2,0,"mat-error",8),e.k0s(),e.j41(28,"mat-form-field",6)(29,"mat-label"),e.EFF(30,"Repetir Contrase\xf1a"),e.k0s(),e.nrm(31,"input",12),e.DNE(32,te,2,0,"mat-error",8)(33,oe,2,0,"mat-error",8),e.k0s(),e.j41(34,"button",13),e.EFF(35," Registrarse "),e.k0s(),e.j41(36,"span",14),e.EFF(37," \xbfYa tienes una cuenta? "),e.j41(38,"a",15),e.EFF(39," Volver al login"),e.k0s()()()()()()()()),2&s&&(e.R7$(5),e.Y8G("formGroup",t.form),e.R7$(5),e.Y8G("ngIf",(null==t.f.name?null:t.f.name.hasError("required"))&&(null==t.f.name?null:t.f.name.untouched)),e.R7$(5),e.Y8G("ngIf",(null==t.f.username?null:t.f.username.hasError("required"))&&(null==t.f.username?null:t.f.username.untouched)),e.R7$(5),e.Y8G("ngIf",(null==t.f.correo?null:t.f.correo.hasError("required"))&&(null==t.f.correo?null:t.f.correo.untouched)),e.R7$(),e.Y8G("ngIf",(null==t.f.correo?null:t.f.correo.hasError("email"))&&(null==t.f.correo?null:t.f.correo.untouched)),e.R7$(5),e.Y8G("ngIf",(null==t.f.password?null:t.f.password.hasError("required"))&&(null==t.f.password?null:t.f.password.untouched)),e.R7$(),e.Y8G("ngIf",(null==t.f.password?null:t.f.password.hasError("minlength"))&&(null==t.f.password?null:t.f.password.untouched)),e.R7$(5),e.Y8G("ngIf",(null==t.f.repeatedPassword?null:t.f.repeatedPassword.hasError("required"))&&(null==t.f.repeatedPassword?null:t.f.repeatedPassword.untouched)),e.R7$(),e.Y8G("ngIf",(null==t.form.errors?null:t.form.errors.passwordsMismatch)&&(null==t.f.repeatedPassword?null:t.f.repeatedPassword.untouched)),e.R7$(),e.Y8G("disabled",t.form.invalid),e.R7$(4),e.Y8G("routerLink",e.lJ4(11,q)))},dependencies:[d.iI,d.Wk,J.G,I.$z,p.rl,p.nJ,p.TL,R.fg,g.RN,g.m2,n.YN,n.qT,n.me,n.BC,n.cb,n.X1,n.j4,n.JD,w.q1,f.bT],encapsulation:2})}}return i})()}]}]}}]);